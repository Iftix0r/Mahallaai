<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mahalla AI - Digital Mahalla System</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/selection.css">
    <link rel="stylesheet" href="css/system.css">
    <link rel="stylesheet" href="css/food.css">
    <link rel="stylesheet" href="css/taxi.css">
    <link rel="stylesheet" href="css/market.css">
    <link rel="stylesheet" href="css/ish.css">
    <link rel="stylesheet" href="css/abedu.css">
    <link rel="stylesheet" href="css/biznes.css">
    <link rel="stylesheet" href="css/bank.css">
    <link rel="stylesheet" href="css/avto.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <div id="app">
        <!-- Loading Screen -->
        <div id="loading" class="screen">
            <div class="loader-content">
                <div class="logo-animation">
                    <img src="https://logobank.uz:8005/static/logos_png/Mahalla_vazirligi.png" alt="Mahalla Logo"
                        class="logo">
                </div>
                <h2>Mahalla AI</h2>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
            </div>
        </div>

        <!-- Selection Screen (Main Menu) -->
        <div id="selection-screen" class="screen hidden">
            <!-- Auth Button Container -->
            <div style="position: absolute; top: 24px; right: 20px; z-index: 100;">
                <div id="auth-state-container">
                    <button class="btn-primary"
                        style="padding: 10px 28px; border-radius: 20px; font-weight: 600; display: flex; align-items: center; gap: 8px; font-size: 0.95rem; cursor: pointer; border: none; outline: none; transition: all 0.3s; white-space: nowrap; box-shadow: 0 4px 12px rgba(0,0,0,0.08); background: white; color: var(--primary-dark);"
                        onclick="openAuthModal()">
                        Kirish
                    </button>
                </div>
            </div>

            <div class="selection-header">
                <h1>Mahalla AI</h1>
                <p>O'zingizga kerakli bo'limni tanlang</p>
            </div>

            <div class="search-bar"
                style="width: 100%; margin-bottom: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border-radius: 16px;">
                <input type="text" id="global-search" placeholder="Xizmatlarni qidirish (taksi, ovqat, mahalla...)">
                <button class="filter-btn">üîç</button>
            </div>

            <div class="selection-grid" id="main-services-grid">
                <div class="selection-card" onclick="switchTab('system')">
                    <div class="card-glow"></div>
                    <div class="card-icon-large">üè¢</div>
                    <div class="card-text">
                        <h3>Tizimga kirish</h3>
                        <p>Mahalla boshqaruvi va davlat xizmatlari</p>
                    </div>
                </div>
                <div class="selection-card accent" onclick="switchTab('food')">
                    <div class="card-glow"></div>
                    <div class="card-icon-large">üçî</div>
                    <div class="card-text">
                        <h3>Mahalla Fast Food</h3>
                        <p>Eng mazali taomlar va tezkor yetkazib berish</p>
                    </div>
                </div>
                <div class="selection-card taxi" onclick="switchTab('taxi')">
                    <div class="card-glow"></div>
                    <div class="card-icon-large">üöï</div>
                    <div class="card-text">
                        <h3>Mahalla Taxi</h3>
                        <p>Tezkor va arzon taksi xizmati</p>
                    </div>
                </div>
                <div class="selection-card market" onclick="switchTab('market')">
                    <div class="card-glow"></div>
                    <div class="card-icon-large">üõí</div>
                    <div class="card-text">
                        <h3>Mahalla Market</h3>
                        <p>Yaqin do'konlardan mahsulotlar buyurtma qiling</p>
                    </div>
                </div>
                <div class="selection-card ish" onclick="switchTab('ish')">
                    <div class="card-glow"></div>
                    <div class="card-icon-large">üíº</div>
                    <div class="card-text">
                        <h3>Mahalla Ish</h3>
                        <p>Bo'sh ish o'rinlari va e'lonlar markazi</p>
                    </div>
                </div>
                <div class="selection-card abedu" onclick="switchTab('abedu')">
                    <div class="card-glow"></div>
                    <div class="card-icon-large">üéì</div>
                    <div class="card-text">
                        <h3>AB Education</h3>
                        <p>Aka-uka Bektoshevlar zamonaviy ta'lim markazi</p>
                    </div>
                </div>
                <div class="selection-card avto" onclick="switchTab('avto')">
                    <div class="card-glow"></div>
                    <div class="card-icon-large">üöó</div>
                    <div class="card-text">
                        <h3>Mahalla Avto</h3>
                        <p>Mashina e'lonlari va avtosalonlar</p>
                    </div>
                </div>
            </div>

            <!-- Biznes qo'shish tugmasi (faqat asosiy menyuda) -->
            <button class="add-biznes-btn" onclick="switchTab('biznes')">
                <span class="icon">üìà</span> O'z biznesingizni qo'shing
            </button>
        </div>
    </div>

    <!-- Dashboard (System) -->
    <div id="dashboard" class="screen hidden">
        <header>
            <div class="user-profile">
                <button class="back-to-menu" onclick="switchTab('menu')">‚Üê</button>
                <div class="avatar" id="user-avatar">M</div>
                <div class="user-info">
                    <h3 id="user-name">Foydalanuvchi</h3>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span id="user-balance-display"
                            style="background: rgba(16, 185, 129, 0.1); color: #10b981; padding: 2px 8px; border-radius: 8px; font-size: 0.85rem; font-weight: 700;">0
                            so'm</span>
                        <button onclick="openRechargeModal()"
                            style="border: none; background: none; color: var(--primary); font-size: 1.1rem; cursor: pointer; padding: 0;">‚ûï</button>
                    </div>
                </div>
            </div>
            <button class="notification-btn" style="border: none; background: none; font-size: 1.2rem;">
                üîî
            </button>
        </header>

        <main>
            <section class="banner">
                <div class="banner-content">
                    <h4>Mahalla AI bilan yanada oson!</h4>
                    <p>Barcha davlat xizmatlari va mahalla yangiliklari endi bitta ilovada.</p>
                    <button class="btn-primary" onclick="switchTab('chat')">AI Yordamchi</button>
                </div>
            </section>

            <section class="stats-container">
                <div class="stat-item">
                    <span class="stat-value">1,250</span>
                    <span class="stat-label">Aholi</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">98%</span>
                    <span class="stat-label">Xizmatlar</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">4.9</span>
                    <span class="stat-label">Reyting</span>
                </div>
            </section>

            <section class="services-container">
                <div class="section-title">
                    <h3>Asosiy xizmatlar</h3>
                    <a href="#">Barchasi</a>
                </div>
                <div class="grid">
                    <div class="service-card" onclick="openService('certificates')">
                        <div class="card-icon blue">üìÑ</div>
                        <span>Ma'lumotnoma</span>
                    </div>
                    <div class="service-card" onclick="openService('applications')">
                        <div class="card-icon green">üìù</div>
                        <span>Arizalar</span>
                    </div>
                    <div class="service-card" onclick="openService('social')">
                        <div class="card-icon orange">üõ°Ô∏è</div>
                        <span>Ijtimoiy yordam</span>
                    </div>
                    <div class="service-card" onclick="openService('police')">
                        <div class="card-icon purple">‚öñÔ∏è</div>
                        <span>Huquqiy maslahat</span>
                    </div>
                </div>
            </section>

            <section class="news-container">
                <div class="section-title">
                    <h3>Mahalla yangiliklari</h3>
                </div>
                <div class="news-list">
                    <div class="news-item">
                        <div class="news-thumb"></div>
                        <div class="news-info">
                            <h5>"Obod Mahalla" yangi bosqichda</h5>
                            <p>Mahallamizda yangi suv quvurlari o'tkazish ishlari boshlandi.</p>
                        </div>
                    </div>
                    <div class="news-item">
                        <div class="news-thumb"></div>
                        <div class="news-info">
                            <h5>Haftalik sport musobaqasi</h5>
                            <p>Kelasi yakshanba kuni yoshlar o'rtasida mini-futbol turniri bo'lib o'tadi.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('system')">
                <div class="icon">üè†</div>
                <span>Asosiy</span>
            </div>
            <div class="nav-item" onclick="openService('catalog')">
                <div class="icon">üìÅ</div>
                <span>Katalog</span>
            </div>
            <div class="nav-item" onclick="switchTab('chat')">
                <div class="icon">üí¨</div>
                <span>Chatbot</span>
            </div>
            <div class="nav-item" onclick="openService('profile')">
                <div class="icon">üë§</div>
                <span>Profil</span>
            </div>
        </nav>
    </div>

    <!-- Food App Screen -->
    <div id="food-app" class="screen hidden">
        <header class="food-header">
            <div class="food-header-top">
                <button class="back-to-menu-dark" onclick="switchTab('menu')">‚Üê</button>
                <div class="food-location">
                    <span class="loc-icon">üìç</span>
                    <span id="food-user-location">Hozirgi joylashuvingiz</span>
                </div>
                <button class="cart-btn">üõí<span class="cart-count">0</span></button>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="Ovqat yoki restoran qidirish...">
                <button class="filter-btn">üîç</button>
            </div>
        </header>

        <main class="food-main">
            <section class="food-categories">
                <div class="cat-item active">üçî Barchasi</div>
                <div class="cat-item">üçü Fast Food</div>
                <div class="cat-item">ü•§ Ichimliklar</div>
                <div class="cat-item">üç∞ Shirinliklar</div>
                <div class="cat-item">üçï Pitsa</div>
            </section>

            <section class="food-offers">
                <div class="offer-card">
                    <div class="offer-content">
                        <h3>20% CHEGIRMA</h3>
                        <p>Ilk buyurtmangiz uchun maxsus taklif</p>
                        <button class="btn-offer">Olish</button>
                    </div>
                    <div class="offer-img">
                        <img src="https://images.unsplash.com/photo-1568901346375-23c9450c58cd?auto=format&fit=crop&w=200&q=80"
                            alt="Burger">
                    </div>
                </div>
            </section>

            <section class="food-nearby">
                <div class="section-title">
                    <h3>Yaqin atrofdagi joylar</h3>
                    <a href="#">Barchasi</a>
                </div>
                <div class="food-grid" id="restaurants-list">
                    <!-- Restaurants will be loaded here -->
                    <div class="rest-card">
                        <div class="rest-img"
                            style="background-image: url('https://images.unsplash.com/photo-1513104890138-7c749659a591?auto=format&fit=crop&w=400&q=80')">
                            <span class="rating">‚≠ê 4.8</span>
                        </div>
                        <div class="rest-info">
                            <h4>Gozzo Pitsa</h4>
                            <p>Pitsa ‚Ä¢ Fast Food ‚Ä¢ 15-20 min</p>
                        </div>
                    </div>
                    <div class="rest-card">
                        <div class="rest-img"
                            style="background-image: url('https://images.unsplash.com/photo-1561758033-d89a9ad46330?auto=format&fit=crop&w=400&q=80')">
                            <span class="rating">‚≠ê 4.5</span>
                        </div>
                        <div class="rest-info">
                            <h4>Max Way</h4>
                            <p>Burger ‚Ä¢ Lavash ‚Ä¢ 10-15 min</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="food-popular">
                <div class="section-title">
                    <h3>Ommabop taomlar</h3>
                </div>
                <div class="popular-list">
                    <div class="food-item-horizontal">
                        <div class="food-thumb"
                            style="background-image: url('https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?auto=format&fit=crop&w=200&q=80')">
                        </div>
                        <div class="food-details">
                            <h5>Double Cheeseburger</h5>
                            <p>Sershira go'sht va pishloq</p>
                            <div class="price-row">
                                <span class="price">35 000 so'm</span>
                                <button class="add-to-cart">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Taxi App Screen -->
    <div id="taxi-app" class="screen hidden">
        <header class="taxi-header">
            <div class="food-header-top">
                <button class="back-to-menu-dark" onclick="switchTab('menu')">‚Üê</button>
                <h3 style="font-weight: 700; font-size: 1.1rem;">Mahalla Taxi</h3>
                <div style="width: 40px;"></div>
            </div>
        </header>

        <main class="taxi-main">
            <!-- Map Placeholder -->
            <div class="taxi-map">
                <div class="map-overlay">
                    <div class="map-pin">üìç</div>
                    <p>Joylashuvingiz aniqlanmoqda...</p>
                </div>
            </div>

            <!-- Route Input -->
            <div class="taxi-panel">
                <div class="route-card">
                    <div class="route-input">
                        <div class="route-dot green"></div>
                        <input type="text" id="taxi-from" placeholder="Qayerdan?" value="Hozirgi joylashuv">
                    </div>
                    <div class="route-line"></div>
                    <div class="route-input">
                        <div class="route-dot red"></div>
                        <input type="text" id="taxi-to" placeholder="Qayerga?">
                    </div>
                </div>

                <!-- Car Types -->
                <div class="car-types">
                    <div class="car-type active">
                        <div class="car-icon">üöó</div>
                        <div class="car-info">
                            <h5>Standart</h5>
                            <span>5 min</span>
                        </div>
                        <div class="car-price">8 000</div>
                    </div>
                    <div class="car-type">
                        <div class="car-icon">üöô</div>
                        <div class="car-info">
                            <h5>Comfort</h5>
                            <span>8 min</span>
                        </div>
                        <div class="car-price">15 000</div>
                    </div>
                    <div class="car-type">
                        <div class="car-icon">üöê</div>
                        <div class="car-info">
                            <h5>Minivan</h5>
                            <span>12 min</span>
                        </div>
                        <div class="car-price">20 000</div>
                    </div>
                </div>

                <!-- Order Button -->
                <button class="taxi-order-btn" onclick="orderTaxi()">
                    Taksi chaqirish
                </button>
            </div>
        </main>
    </div>

    <!-- Market App Screen -->
    <div id="market-app" class="screen hidden">
        <header class="market-header">
            <div class="food-header-top">
                <button class="back-to-menu-dark" onclick="switchTab('menu')">‚Üê</button>
                <h3 style="font-weight: 700; font-size: 1.1rem;">Mahalla Market</h3>
                <button class="cart-btn" onclick="openMarketCart()">üõí<span class="cart-count"
                        id="market-cart-count">0</span></button>
            </div>
            <div class="search-bar">
                <input type="text" id="market-search" placeholder="Mahsulot qidirish...">
                <button class="filter-btn">üîç</button>
            </div>
        </header>

        <main class="market-main">
            <!-- Categories -->
            <section class="market-categories">
                <div class="mcat-item active" data-cat="all">üè† Barchasi</div>
                <div class="mcat-item" data-cat="fruits">üçé Mevalar</div>
                <div class="mcat-item" data-cat="vegetables">ü•¶ Sabzavotlar</div>
                <div class="mcat-item" data-cat="dairy">üßÄ Sut mahsulotlari</div>
                <div class="mcat-item" data-cat="meat">ü•© Go'sht</div>
                <div class="mcat-item" data-cat="bread">üçû Non</div>
                <div class="mcat-item" data-cat="drinks">üßÉ Ichimliklar</div>
                <div class="mcat-item" data-cat="cleaning">üßΩ Tozalik</div>
            </section>

            <!-- Nearby Stores -->
            <section class="market-stores">
                <div class="section-title">
                    <h3>Yaqin do'konlar</h3>
                </div>
                <div class="store-scroll">
                    <div class="store-chip active">üè™ Barcha do'konlar</div>
                    <div class="store-chip">Korzinka</div>
                    <div class="store-chip">Makro</div>
                    <div class="store-chip">Havas</div>
                </div>
            </section>

            <!-- Products Grid -->
            <section class="market-products">
                <div class="section-title">
                    <h3>Mahsulotlar</h3>
                    <span id="product-count">12 ta</span>
                </div>
                <div class="products-grid" id="products-grid">
                    <div class="product-card" data-cat="fruits" data-name="Olma" data-price="12000">
                        <div class="product-img" style="background: #fef3c7;"><span>üçé</span></div>
                        <div class="product-info">
                            <h5>Olma</h5>
                            <p>1 kg</p>
                            <div class="product-bottom">
                                <span class="product-price">12 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="fruits" data-name="Banan" data-price="18000">
                        <div class="product-img" style="background: #fef9c3;"><span>üçå</span></div>
                        <div class="product-info">
                            <h5>Banan</h5>
                            <p>1 kg</p>
                            <div class="product-bottom">
                                <span class="product-price">18 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="vegetables" data-name="Pomidor" data-price="8000">
                        <div class="product-img" style="background: #fee2e2;"><span>üçÖ</span></div>
                        <div class="product-info">
                            <h5>Pomidor</h5>
                            <p>1 kg</p>
                            <div class="product-bottom">
                                <span class="product-price">8 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="vegetables" data-name="Kartoshka" data-price="5000">
                        <div class="product-img" style="background: #fef3c7;"><span>ü•î</span></div>
                        <div class="product-info">
                            <h5>Kartoshka</h5>
                            <p>1 kg</p>
                            <div class="product-bottom">
                                <span class="product-price">5 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="dairy" data-name="Sut" data-price="14000">
                        <div class="product-img" style="background: #eff6ff;"><span>ü•õ</span></div>
                        <div class="product-info">
                            <h5>Sut (1L)</h5>
                            <p>Lactel</p>
                            <div class="product-bottom">
                                <span class="product-price">14 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="dairy" data-name="Pishloq" data-price="32000">
                        <div class="product-img" style="background: #fef9c3;"><span>üßÄ</span></div>
                        <div class="product-info">
                            <h5>Pishloq</h5>
                            <p>1 kg</p>
                            <div class="product-bottom">
                                <span class="product-price">32 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="meat" data-name="Mol go'shti" data-price="85000">
                        <div class="product-img" style="background: #fee2e2;"><span>ü•©</span></div>
                        <div class="product-info">
                            <h5>Mol go'shti</h5>
                            <p>1 kg</p>
                            <div class="product-bottom">
                                <span class="product-price">85 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="meat" data-name="Tovuq" data-price="28000">
                        <div class="product-img" style="background: #fef3c7;"><span>üçó</span></div>
                        <div class="product-info">
                            <h5>Tovuq</h5>
                            <p>1 kg</p>
                            <div class="product-bottom">
                                <span class="product-price">28 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="bread" data-name="Non" data-price="3000">
                        <div class="product-img" style="background: #fef3c7;"><span>üçû</span></div>
                        <div class="product-info">
                            <h5>Non (patir)</h5>
                            <p>1 dona</p>
                            <div class="product-bottom">
                                <span class="product-price">3 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="drinks" data-name="Coca-Cola" data-price="9000">
                        <div class="product-img" style="background: #fee2e2;"><span>üßÉ</span></div>
                        <div class="product-info">
                            <h5>Coca-Cola</h5>
                            <p>1.5L</p>
                            <div class="product-bottom">
                                <span class="product-price">9 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="drinks" data-name="Suv" data-price="3000">
                        <div class="product-img" style="background: #e0f2fe;"><span>üíß</span></div>
                        <div class="product-info">
                            <h5>Nestle Pure</h5>
                            <p>1.5L</p>
                            <div class="product-bottom">
                                <span class="product-price">3 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="product-card" data-cat="cleaning" data-name="Kir yuvish" data-price="25000">
                        <div class="product-img" style="background: #ede9fe;"><span>üßΩ</span></div>
                        <div class="product-info">
                            <h5>Ariel (1kg)</h5>
                            <p>Kir yuvish kukuni</p>
                            <div class="product-bottom">
                                <span class="product-price">25 000</span>
                                <button class="add-product-btn" onclick="addToMarketCart(this)">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Floating Cart Bar -->
        <div class="market-cart-bar hidden" id="market-cart-bar" onclick="openMarketCart()">
            <div class="cart-bar-left">
                <span class="cart-bar-icon">üõí</span>
                <span class="cart-bar-text" id="cart-bar-items">0 ta mahsulot</span>
            </div>
            <div class="cart-bar-total" id="cart-bar-total">0 so'm</div>
        </div>

        <!-- Cart Modal -->
        <div id="market-cart-modal" class="modal-backdrop hidden">
            <div class="modal" style="max-height: 85vh; display: flex; flex-direction: column;">
                <div class="modal-header">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h3>Savatingiz</h3>
                            <p>Buyurtmani tasdiqlang</p>
                        </div>
                        <button onclick="closeMarketCart()"
                            style="border: none; background: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                    </div>
                </div>
                <div class="modal-body" style="overflow-y: auto; flex: 1;" id="cart-items-list">
                    <p style="text-align: center; color: var(--text-muted); padding: 20px;">Savat bo'sh</p>
                </div>
                <div class="modal-footer">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <span style="font-weight: 600;">Jami:</span>
                        <span style="font-weight: 800; font-size: 1.2rem; color: var(--primary);"
                            id="cart-modal-total">0 so'm</span>
                    </div>
                    <button class="btn-primary"
                        style="width: 100%; padding: 14px; border-radius: 14px; font-size: 1rem;"
                        onclick="placeMarketOrder()">Buyurtma berish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-backdrop hidden">
        <div class="modal">
            <div class="modal-header">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h3 id="auth-title">Tizimga kirish</h3>
                        <p id="auth-subtitle">Mahalla AI xizmatlaridan foydalanish uchun kiring</p>
                    </div>
                    <button onclick="closeAuthModal()"
                        style="border: none; background: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Telefon raqam yoki Email</label>
                    <input type="text" id="auth-input" placeholder="+998 90 123 45 67">
                </div>
                <div class="form-group">
                    <label>Parol</label>
                    <input type="password" id="auth-password" placeholder="Parolni kiriting">
                </div>
                <button class="btn-primary"
                    style="width: 100%; margin-bottom: 12px; padding: 14px; border-radius: 14px; font-size: 1rem;"
                    onclick="loginMock()">Davom etish</button>

                <div
                    style="text-align: center; margin: 16px 0; color: var(--text-muted); font-size: 0.9rem; position: relative;">
                    <hr
                        style="border: none; border-top: 1px solid #e2e8f0; position: absolute; top: 50%; left: 0; right: 0; z-index: 1;">
                    <span style="background: white; padding: 0 10px; position: relative; z-index: 2;">YOKI</span>
                </div>

                <button
                    style="width: 100%; padding: 12px; border-radius: 14px; border: 1px solid #e2e8f0; background: white; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: 500; cursor: pointer; transition: background 0.2s;"
                    onclick="loginMock()" onmouseover="this.style.backgroundColor='#f8fafc'"
                    onmouseout="this.style.backgroundColor='white'">
                    <svg viewBox="0 0 24 24" width="20" height="20" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                            fill="#4285F4" />
                        <path
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                            fill="#34A853" />
                        <path
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                            fill="#FBBC05" />
                        <path
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                            fill="#EA4335" />
                        <path d="M1 1h22v22H1z" fill="none" />
                    </svg>
                    Google orqali kirish
                </button>

                <p style="text-align: center; margin-top: 16px; font-size: 0.9rem; color: var(--text-muted);">
                    Akkauntingiz yo'qmi? <a href="#"
                        style="color: var(--primary); font-weight: 600; text-decoration: none;"
                        onclick="toggleAuthMode()">Ro'yxatdan o'tish</a>
                </p>
            </div>
        </div>
    </div>

    <!-- AI Assistant Tab -->
    <div id="ai-chat" class="screen hidden">
        <header>
            <div style="display: flex; align-items: center; gap: 15px;">
                <button onclick="switchTab('system')"
                    style="border: none; background: none; font-size: 1.5rem; cursor: pointer;">‚Üê</button>
                <h3 style="font-weight: 700;">Mahalla AI Yordamchi</h3>
            </div>
        </header>
        <div class="chat-container" id="chat-messages">
            <div class="message ai">
                <p>Assalomu alaykum! Men Mahalla AI yordamchisiman. Sizga qanday yordam bera olaman?</p>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" placeholder="Xabaringizni yozing..." id="chat-input">
            <button id="send-btn">üöÄ</button>
        </div>
    </div>

    <!-- Mahalla Ish App -->
    <div id="ish-app" class="screen hidden">
        <header class="ish-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <button class="back-to-menu-dark" onclick="switchTab('menu')">‚Üê</button>
                <h3 style="font-weight: 700; font-size: 1.1rem;">Mahalla Ish</h3>
            </div>
            <button class="add-job-btn" onclick="openAddJobModal()">+ Maxsus E'lon</button>
        </header>

        <div class="search-bar" style="margin: 20px;">
            <input type="text" id="ish-search" placeholder="Kasb yoki ish qidirish...">
            <button class="filter-btn">üîç</button>
        </div>

        <div class="ish-categories">
            <div class="cat-item active" data-cat="all">Barchasi</div>
            <div class="cat-item" data-cat="qurilish">üèó Qurilish</div>
            <div class="cat-item" data-cat="savdo">üõí Savdo</div>
            <div class="cat-item" data-cat="xizmat">üë®‚Äçüîß Xizmat ko'rsatish</div>
            <div class="cat-item" data-cat="it">üíª IT / Ta'lim</div>
        </div>

        <div class="jobs-list" id="jobs-list">
            <!-- Job cards will be injected by JS -->
        </div>
    </div>

    <!-- Add Job Modal -->
    <div id="add-job-modal" class="modal-backdrop hidden">
        <div class="modal">
            <div class="modal-header">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h3>E'lon berish</h3>
                        <p>Yangi ish o'rnini tizimga qo'shish</p>
                    </div>
                    <button onclick="closeAddJobModal()"
                        style="border: none; background: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Lavozim (Kasb)</label>
                    <input type="text" id="job-title" placeholder="Masalan: Sotuvchi ustasi">
                </div>
                <div class="form-group">
                    <label>Kategoriya</label>
                    <select id="job-cat">
                        <option value="qurilish">Qurilish</option>
                        <option value="savdo">Savdo</option>
                        <option value="xizmat">Xizmat ko'rsatish</option>
                        <option value="it">IT / Ta'lim</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Maosh (So'm)</label>
                    <input type="text" id="job-salary" placeholder="Masalan: 3 000 000 - 5 000 000">
                </div>
                <div class="form-group">
                    <label>Telefon raqam</label>
                    <input type="tel" id="job-phone" placeholder="+998 90 123 45 67">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" style="width: 100%;" onclick="submitJob()">Tartibni joylash</button>
            </div>
        </div>
    </div>

    <!-- AB Education App -->
    <div id="abedu-app" class="screen hidden" style="padding-bottom: 0;">
        <header class="abedu-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <button class="back-to-menu-dark" onclick="switchTab('menu')">‚Üê</button>
                <h3 style="font-weight: 700; font-size: 1.1rem; color: white;">AB Education</h3>
            </div>
        </header>
        <div class="iframe-container">
            <iframe src="https://abedu.uz" frameborder="0" width="100%" height="100%"></iframe>
        </div>
    </div>

    <!-- Mahalla Biznes App (Admin/Owner View) -->
    <div id="biznes-app" class="screen hidden" style="background:#f1f5f9; padding-bottom:80px;">
        <header class="biznes-header">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 15px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="back-to-menu-dark" onclick="switchTab('menu')">‚Üê</button>
                    <h3 style="font-weight: 700; font-size: 1.1rem; color: #1e293b;">Mahalla Biznes</h3>
                </div>
            </div>
        </header>

        <main class="biznes-main">
            <!-- If no business, show creation view -->
            <div id="biznes-create-view" style="padding: 20px;">
                <div class="empty-state-biznes">
                    <div class="biz-illustration">üè™</div>
                    <h2>Biznesingiz ro'yxatda yo'qmi?</h2>
                    <p>Mahalla AI tarmog'ida o'z do'kon, oshxona yoki xizmatingizni oching va qo'shnilarga sotishni
                        boshlang!</p>

                    <div class="biz-form">
                        <div class="form-group">
                            <label>Biznes nomi</label>
                            <input type="text" id="biz-name" placeholder="Masalan: 'Oq-tepa lavash' yoki 'Bek Do'koni'">
                        </div>
                        <div class="form-group">
                            <label>Biznes sohasi</label>
                            <select id="biz-category">
                                <option value="food">üç± Fast Food & Oshxona</option>
                                <option value="market">üõí Oziq-ovqat va Market</option>
                                <option value="service">üîß Xizmat ko'rsatish</option>
                                <option value="other">üì¶ Boshqa</option>
                            </select>
                        </div>
                        <button class="btn-primary" style="width:100%; padding:16px; border-radius:16px;"
                            onclick="createBiznes()">Biznesni Yaratish ü™Ñ</button>
                    </div>
                </div>
            </div>

            <!-- If user has business, show dashboard view -->
            <div id="biznes-dashboard-view" class="hidden">
                <!-- Dashboard header details -->
                <div class="biz-profile-card">
                    <div class="biz-profile-header">
                        <div class="biz-logo" id="biz-dash-logo">B</div>
                        <div class="biz-info">
                            <h2 id="biz-dash-name">Biznes Nomi</h2>
                            <p id="biz-dash-cat">üõí Market</p>
                        </div>
                        <button class="biz-edit-btn">‚öôÔ∏è</button>
                    </div>
                    <div class="biz-stats-grid">
                        <div class="bz-stat">
                            <span>Kassa (Bugun)</span>
                            <h4>0 so'm</h4>
                        </div>
                        <div class="bz-stat">
                            <span>Buyurtmalar</span>
                            <h4>0 ta</h4>
                        </div>
                    </div>
                </div>

                <div class="biz-tabs">
                    <button class="bz-tab active" data-target="bz-orders">Buyurtmalar <span
                            class="badge">0</span></button>
                    <button class="bz-tab" data-target="bz-products">Mahsulotlar</button>
                    <button class="bz-tab" data-target="bz-settings">Sozlamalar</button>
                </div>

                <div class="bz-content-area">
                    <!-- Orders Tab -->
                    <div id="bz-orders" class="bz-tab-content active">
                        <div class="empty-orders">
                            <span>üìù</span>
                            <p>Hozircha yangi buyurtmalar yo'q</p>
                        </div>
                    </div>

                    <!-- Products Tab -->
                    <div id="bz-products" class="bz-tab-content hidden">
                        <button class="btn-outline-primary" onclick="addProduct()"
                            style="width:100%; padding:14px; border-radius:12px; margin-bottom:15px; background: white; border: 2px dashed #cbd5e1; font-weight: 600; cursor:pointer; display:flex; gap:10px; align-items:center; justify-content:center; color: var(--primary);">
                            <span>‚ûï</span> Yangi mahsulot qo'shish
                        </button>
                        <div class="bz-product-list">
                            <p style="text-align:center; color:#94a3b8; font-size:0.9rem; margin-top: 20px;">Hali
                                mahsulot qo'shmadingiz</p>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="bz-settings" class="bz-tab-content hidden">
                        <div class="bz-card">
                            <h4>Do'kon holati</h4>
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                                <span>Ochiq/Yopiq</span>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                        <div class="bz-card" style="margin-top:15px;">
                            <h4>Yetkazib berish</h4>
                            <div class="form-group" style="margin-top:10px;">
                                <label style="font-size:0.8rem;">Dastavka narxi (so'm)</label>
                                <input type="number" placeholder="5000">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>



    <!-- Profile Setup Modal -->
    <div id="profile-modal" class="modal-backdrop hidden">
        <div class="modal">
            <div class="modal-header">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <h3>Profilni to'ldiring</h3>
                        <p>Xizmatlardan foydalanish uchun hududingizni kiriting</p>
                    </div>
                    <button onclick="closeProfileModal()"
                        style="border: none; background: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Viloyat / Shaxar</label>
                    <select id="setup-region">
                        <option value="">Tanlang...</option>
                        <option value="Toshkent sh.">Toshkent sh.</option>
                        <option value="Toshkent vil.">Toshkent vil.</option>
                        <option value="Samarqand">Samarqand</option>
                        <option value="Buxoro">Buxoro</option>
                        <option value="Namangan">Namangan</option>
                        <option value="Farg'ona">Farg'ona</option>
                        <option value="Andijon">Andijon</option>
                        <option value="Qashqadaryo">Qashqadaryo</option>
                        <option value="Surxondaryo">Surxondaryo</option>
                        <option value="Jizzax">Jizzax</option>
                        <option value="Sirdaryo">Sirdaryo</option>
                        <option value="Xorazm">Xorazm</option>
                        <option value="Navoiy">Navoiy</option>
                        <option value="Qoraqalpog'iston">Qoraqalpog'iston</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mahalla nomi</label>
                    <input type="text" id="setup-mahalla" placeholder="Masalan: Alisher Navoiy">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" style="width: 100%;" id="save-profile">Saqlash</button>
            </div>
        </div>
    </div>
    </div>

    <!-- Mahalla Avto App -->
    <div id="avto-app" class="screen hidden">
        <header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; position: sticky; top: 0; z-index: 100;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <button class="back-to-menu" onclick="switchTab('menu')" style="background: rgba(255,255,255,0.2); color: white; border: none;">‚Üê</button>
                <h3 style="font-weight: 700; font-size: 1.1rem;">üöó Mahalla Avto</h3>
            </div>
        </header>

        <div class="avto-container">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchAvtoTab('cars')">Mashinalar</button>
                <button class="tab" onclick="switchAvtoTab('salons')">Avtosalonlar</button>
                <button class="tab" onclick="switchAvtoTab('my')">Mening E'lonlarim</button>
            </div>

            <!-- Cars Tab -->
            <div id="avto-cars-tab" class="avto-tab-content">
                <!-- Filters -->
                <div class="filters-section">
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Turi</label>
                            <select id="filter-type">
                                <option value="">Barchasi</option>
                                <option value="salon">Avtosalon</option>
                                <option value="private">Shaxsiy</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Brend</label>
                            <select id="filter-brand">
                                <option value="">Barcha brendlar</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Min Narx ($)</label>
                            <input type="number" id="filter-min-price" placeholder="0">
                        </div>
                        <div class="filter-group">
                            <label>Max Narx ($)</label>
                            <input type="number" id="filter-max-price" placeholder="100000">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="applyFilters()" style="margin-top: 16px; width: 100%;">
                        <i class="fas fa-search"></i> Qidirish
                    </button>
                </div>

                <!-- Cars Grid -->
                <div id="cars-container" class="cars-grid"></div>
            </div>

            <!-- Salons Tab -->
            <div id="avto-salons-tab" class="avto-tab-content hidden">
                <div id="salons-container"></div>
            </div>

            <!-- My Cars Tab -->
            <div id="avto-my-tab" class="avto-tab-content hidden">
                <button class="btn btn-primary" onclick="showAddCarForm()" style="margin-bottom: 20px; width: 100%;">
                    <i class="fas fa-plus"></i> E'lon Berish
                </button>
                <div id="my-cars-container"></div>
            </div>
        </div>

        <!-- Add Car Modal -->
        <div id="add-car-modal" class="modal-backdrop hidden">
            <div class="modal" style="max-width: 600px;">
                <div class="modal-header">
                    <h3>E'lon Berish</h3>
                    <button onclick="closeAddCarModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="add-car-form" class="add-car-form">
                        <div class="form-section">
                            <h3>Asosiy Ma'lumotlar</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Brend *</label>
                                    <input type="text" id="car-brand" required placeholder="Toyota">
                                </div>
                                <div class="form-group">
                                    <label>Model *</label>
                                    <input type="text" id="car-model" required placeholder="Camry">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Yil *</label>
                                    <input type="number" id="car-year" required placeholder="2020">
                                </div>
                                <div class="form-group">
                                    <label>Narx ($) *</label>
                                    <input type="number" id="car-price" required placeholder="25000">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Texnik Xususiyatlar</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Yurgan (km)</label>
                                    <input type="number" id="car-mileage" placeholder="50000">
                                </div>
                                <div class="form-group">
                                    <label>Yoqilg'i</label>
                                    <select id="car-fuel">
                                        <option value="Benzin">Benzin</option>
                                        <option value="Dizel">Dizel</option>
                                        <option value="Gaz">Gaz</option>
                                        <option value="Elektr">Elektr</option>
                                        <option value="Gibrid">Gibrid</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Uzatma</label>
                                    <select id="car-transmission">
                                        <option value="Avtomat">Avtomat</option>
                                        <option value="Mexanik">Mexanik</option>
                                        <option value="Robot">Robot</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Rang</label>
                                    <input type="text" id="car-color" placeholder="Oq">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Aloqa</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Telefon *</label>
                                    <input type="tel" id="car-phone" required placeholder="+998901234567">
                                </div>
                                <div class="form-group">
                                    <label>Joylashuv</label>
                                    <input type="text" id="car-location" placeholder="Toshkent, Chilonzor">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Tavsif</label>
                                <textarea id="car-description" placeholder="Mashina haqida qo'shimcha ma'lumot..."></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-check"></i> E'lon Berish
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="js/core.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/food.js"></script>
    <script src="js/taxi.js"></script>
    <script src="js/market.js"></script>
    <script src="js/ish.js"></script>
    <script src="js/biznes.js"></script>
    <script src="js/avto.js"></script>

    <script>
        // Auth Logic
        let isLoggedIn = false;
        let authMode = 'login'; // login or register

        function updateAuthState() {
            const container = document.getElementById('auth-state-container');
            if (!container) return;

            if (isLoggedIn) {
                container.innerHTML = `
                    <div onclick="openService('profile'); if(typeof switchTab === 'function'){switchTab('system')}" style="width: 36px; height: 36px; border-radius: 50%; background-color: #e91e63; color: white; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 16px; cursor: pointer; user-select: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 2px solid white; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        I
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <button class="btn-primary" style="padding: 8px 24px; border-radius: 20px; font-weight: 500; display: flex; align-items: center; gap: 8px; font-size: 0.95rem; cursor: pointer; border: none; outline: none; transition: background 0.2s; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.1);" onclick="openAuthModal()">
                        Kirish
                    </button>
                `;
            }
        }

        function openAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
        }

        function toggleAuthMode() {
            authMode = authMode === 'login' ? 'register' : 'login';
            const title = document.getElementById('auth-title');
            const subtitle = document.getElementById('auth-subtitle');

            if (authMode === 'login') {
                title.innerText = 'Tizimga kirish';
                subtitle.innerText = 'Mahalla AI xizmatlaridan foydalanish uchun kiring';
            } else {
                title.innerText = "Ro'yxatdan o'tish";
                subtitle.innerText = 'Yangi akkaunt yarating va imkoniyatlardan foydalaning';
            }

            // Re-render toggle text
            const toggleText = authMode === 'login' ? "Ro'yxatdan o'tish" : "Kirish";
            const helperText = authMode === 'login' ? "Akkauntingiz yo'qmi?" : "Akkauntingiz bormi?";
            const linkTag = document.querySelector('#auth-modal p a');
            if (linkTag) {
                linkTag.innerText = toggleText;
                linkTag.parentElement.innerHTML = `${helperText} <a href="#" style="color: var(--primary); font-weight: 600; text-decoration: none;" onclick="toggleAuthMode()">${toggleText}</a>`;
            }
        }

        async function loginMock() {
            const input = document.getElementById('auth-input').value;
            const password = document.getElementById('auth-password').value;

            if (!input || !password) {
                alert("Iltimos, barcha qatorlarni to'ldiring!");
                return;
            }

            const action = authMode === 'login' ? 'web_login' : 'web_register';
            try {
                const response = await fetch(`api/index.php?action=${action}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: input,
                        password: password
                    })
                });

                const result = await response.json();
                if (result.status === 'success') {
                    isLoggedIn = true;
                    closeAuthModal();

                    if (typeof updateUI === 'function') {
                        updateUI(result.user);
                    }

                    updateAuthState();
                    const nameEl = document.getElementById('user-name');
                    if (nameEl) nameEl.innerText = result.user.fullname || 'Foydalanuvchi';

                    if (authMode === 'register') {
                        alert("Muvaffaqiyatli ro'yxatdan o'tdingiz!");
                    }
                } else {
                    alert('Xatolik: ' + result.message);
                }
            } catch (e) {
                console.error(e);
                alert("Server bilan aloqa uzildi.");
            }
        }

        // Initialize auth state
        updateAuthState();
    </script>
</body>

</html>
```